---
import ToolCard from "@/components/ui/ToolCard.astro";
import ToolPage from "@/components/ui/ToolPage.astro";
import Layout from "../layouts/Layout.astro";
---

<Layout title="Currency Converter">
  <ToolPage description="Real-time exchange rates at your fingertips.">
    <div class="mx-auto flex w-full min-h-0 flex-1 flex-col max-w-4xl gap-3">
      <ToolCard title="Converter" step="01.">
        <div class="grid gap-3 md:grid-cols-[1fr_auto_1fr] md:items-center">
          <!-- From Currency -->
          <div class="space-y-2 rounded-xl border border-white/10 bg-black/20 p-3 shadow-inner">
            <label for="amount-from">Amount & Currency</label>
            <div class="flex gap-4">
              <input
                type="number"
                id="amount-from"
                value="1"
                min="0"
                step="any"
                class="w-full border-none bg-transparent p-0 text-2xl font-bold focus:ring-0"
              />
              <select id="currency-from" class="w-auto px-4">
                <option value="USD" selected>ðŸ‡ºðŸ‡¸ USD</option>
                <option value="EUR">ðŸ‡ªðŸ‡º EUR</option>
                <option value="GBP">ðŸ‡¬ðŸ‡§ GBP</option>
                <option value="JPY">ðŸ‡¯ðŸ‡µ JPY</option>
                <option value="CAD">ðŸ‡¨ðŸ‡¦ CAD</option>
                <option value="AUD">ðŸ‡¦ðŸ‡º AUD</option>
                <option value="CNY">ðŸ‡¨ðŸ‡³ CNY</option>
                <option value="INR">ðŸ‡®ðŸ‡³ INR</option>
                <option value="CHF">ðŸ‡¨ðŸ‡­ CHF</option>
              </select>
            </div>
            <div
              class="mt-4 rounded-lg bg-white/5 px-4 py-2 text-sm text-slate-400"
              id="rate-display-from"
            >
              1 USD = 0.92 EUR
            </div>
          </div>

          <!-- Swap Button -->
          <div class="flex justify-center">
            <button
              id="swap-btn"
              class="group flex h-12 w-12 items-center justify-center rounded-full border border-white/10 bg-white/5 text-2xl shadow-lg transition-all hover:scale-110 hover:border-indigo-500/50 hover:bg-white/10 active:scale-95 md:rotate-90"
              title="Swap Currencies"
            >
              <span class="transition-transform duration-500 group-hover:rotate-180">â‡„</span>
            </button>
          </div>

          <!-- To Currency -->
          <div class="space-y-2 rounded-xl border border-white/10 bg-black/20 p-3 shadow-inner">
            <label for="amount-to">Converted To</label>
            <div class="flex gap-4">
              <input
                type="text"
                id="amount-to"
                value="0.92"
                readonly
                class="w-full border-none bg-transparent p-0 text-2xl font-bold text-indigo-400 focus:ring-0"
              />
              <select id="currency-to" class="w-auto px-4">
                <option value="USD">ðŸ‡ºðŸ‡¸ USD</option>
                <option value="EUR" selected>ðŸ‡ªðŸ‡º EUR</option>
                <option value="GBP">ðŸ‡¬ðŸ‡§ GBP</option>
                <option value="JPY">ðŸ‡¯ðŸ‡µ JPY</option>
                <option value="CAD">ðŸ‡¨ðŸ‡¦ CAD</option>
                <option value="AUD">ðŸ‡¦ðŸ‡º AUD</option>
                <option value="CNY">ðŸ‡¨ðŸ‡³ CNY</option>
                <option value="INR">ðŸ‡®ðŸ‡³ INR</option>
                <option value="CHF">ðŸ‡¨ðŸ‡­ CHF</option>
              </select>
            </div>
            <div
              class="mt-4 rounded-lg bg-white/5 px-4 py-2 text-sm text-slate-400"
              id="rate-display-to"
            >
              1 EUR = 1.09 USD
            </div>
          </div>
        </div>
      </ToolCard>

      <!-- Popular Conversions -->
      <ToolCard title="Popular Conversions">
        <div class="flex flex-wrap justify-center gap-3">
          <button
            class="quick-pair rounded-full border border-white/10 bg-white/5 px-3 py-3 text-sm font-medium text-slate-300 transition-all hover:border-indigo-500/30 hover:bg-white/10 hover:text-white"
            data-from="USD"
            data-to="EUR">USD â†’ EUR</button
          >
          <button
            class="quick-pair rounded-full border border-white/10 bg-white/5 px-3 py-3 text-sm font-medium text-slate-300 transition-all hover:border-indigo-500/30 hover:bg-white/10 hover:text-white"
            data-from="EUR"
            data-to="USD">EUR â†’ USD</button
          >
          <button
            class="quick-pair rounded-full border border-white/10 bg-white/5 px-3 py-3 text-sm font-medium text-slate-300 transition-all hover:border-indigo-500/30 hover:bg-white/10 hover:text-white"
            data-from="GBP"
            data-to="USD">GBP â†’ USD</button
          >
          <button
            class="quick-pair rounded-full border border-white/10 bg-white/5 px-3 py-3 text-sm font-medium text-slate-300 transition-all hover:border-indigo-500/30 hover:bg-white/10 hover:text-white"
            data-from="USD"
            data-to="JPY">USD â†’ JPY</button
          >
          <button
            class="quick-pair rounded-full border border-white/10 bg-white/5 px-3 py-3 text-sm font-medium text-slate-300 transition-all hover:border-indigo-500/30 hover:bg-white/10 hover:text-white"
            data-from="USD"
            data-to="CAD">USD â†’ CAD</button
          >
        </div>
      </ToolCard>
    </div>
  </ToolPage>
</Layout>

<script>
  // Rates based on USD (Mock Data)
  const rates: Record<string, number> = {
    USD: 1.0,
    EUR: 0.92,
    GBP: 0.79,
    JPY: 150.25,
    CAD: 1.35,
    AUD: 1.52,
    CNY: 7.19,
    INR: 82.9,
    CHF: 0.88,
  };

  // Elements
  const amountFrom = document.getElementById("amount-from") as HTMLInputElement;
  const amountTo = document.getElementById("amount-to") as HTMLInputElement;
  const currencyFrom = document.getElementById("currency-from") as HTMLSelectElement;
  const currencyTo = document.getElementById("currency-to") as HTMLSelectElement;
  const swapBtn = document.getElementById("swap-btn");
  const rateDisplayFrom = document.getElementById("rate-display-from");
  const rateDisplayTo = document.getElementById("rate-display-to");
  const quickPairs = document.querySelectorAll(".quick-pair");

  function calculate() {
    if (!amountFrom || !amountTo || !currencyFrom || !currencyTo) return;

    const fromVal = parseFloat(amountFrom.value) || 0;
    const fromRate = rates[currencyFrom.value];
    const toRate = rates[currencyTo.value];

    // Convert to USD first (base), then to target
    const inUsd = fromVal / fromRate;
    const result = inUsd * toRate;

    // Smart formatting logic
    const formatted =
      result < 0.01 && result > 0
        ? result.toPrecision(4)
        : result.toLocaleString("en-US", { maximumFractionDigits: 2, minimumFractionDigits: 0 });

    amountTo.value = formatted;

    // Update single unit displays
    updateRateDisplays(fromRate, toRate);
  }

  function updateRateDisplays(fromRate: number, toRate: number) {
    if (!rateDisplayFrom || !rateDisplayTo || !currencyFrom || !currencyTo) return;

    const singleUnit = (1 / fromRate) * toRate;
    // e.g. 1 USD = 0.92 EUR
    rateDisplayFrom.textContent = `1 ${currencyFrom.value} = ${singleUnit.toLocaleString(undefined, { maximumFractionDigits: 4 })} ${currencyTo.value}`;

    const reverseUnit = (1 / toRate) * fromRate;
    // e.g. 1 EUR = 1.09 USD
    rateDisplayTo.textContent = `1 ${currencyTo.value} = ${reverseUnit.toLocaleString(undefined, { maximumFractionDigits: 4 })} ${currencyFrom.value}`;
  }

  function swap() {
    if (!currencyFrom || !currencyTo) return;

    // Swap values
    const temp = currencyFrom.value;
    currencyFrom.value = currencyTo.value;
    currencyTo.value = temp;

    // Recalculate
    calculate();

    // Visual feedback
    swapBtn?.classList.add("rotate-180");
    setTimeout(() => swapBtn?.classList.remove("rotate-180"), 500);
  }

  // Listeners
  amountFrom?.addEventListener("input", calculate);
  currencyFrom?.addEventListener("change", calculate);
  currencyTo?.addEventListener("change", calculate);
  swapBtn?.addEventListener("click", swap);

  // Initial calc
  calculate();

  // Quick Pairs
  quickPairs.forEach((btn) => {
    btn.addEventListener("click", () => {
      const from = btn.getAttribute("data-from");
      const to = btn.getAttribute("data-to");

      if (from && to && currencyFrom && currencyTo) {
        currencyFrom.value = from;
        currencyTo.value = to;
        calculate();

        // Highlight effect
        amountFrom?.focus();
      }
    });
  });
</script>
