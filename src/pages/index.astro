---
import Button from "../components/Button.astro";
import Card from "../components/Card.astro";
import Layout from "../layouts/Layout.astro";

const tools = [
  {
    name: "Username Generator",
    icon: "ğŸ‘¤",
    path: "/username-generator",
    desc: "Create unique identifiers for any platform.",
    category: "Identity",
  },
  {
    name: "Password Generator",
    icon: "ğŸ”",
    path: "/password-generator",
    desc: "Generate secure, uncrackable passwords.",
    category: "Security",
  },
  {
    name: "Lottery Generator",
    icon: "ğŸ°",
    path: "/lottery-generator",
    desc: "Test your luck with random numbers.",
    category: "Fun",
  },
  {
    name: "Coin & Dice",
    icon: "ğŸ²",
    path: "/coin-dice",
    desc: "Flip a coin or roll the dice instantly.",
    category: "Fun",
  },
  {
    name: "Food Picker",
    icon: "ğŸ”",
    path: "/food-picker",
    desc: "Can't decide? Let fate choose your meal.",
    category: "Life",
  },
  {
    name: "Currency Converter",
    icon: "ğŸ’±",
    path: "/currency-converter",
    desc: "Real-time exchange rates at a glance.",
    category: "Utility",
  },
  {
    name: "Measure Converter",
    icon: "ğŸ“",
    path: "/measurement-converter",
    desc: "Convert units of measurement easily.",
    category: "Utility",
  },
  {
    name: "Habit Tracker",
    icon: "ğŸ“ˆ",
    path: "/habit-tracker",
    desc: "Build better habits and track progress.",
    category: "Productivity",
  },
  {
    name: "Focus Noise",
    icon: "ğŸ§",
    path: "/focus-noise",
    desc: "Ambient sounds to improve concentration.",
    category: "Productivity",
  },
  {
    name: "ASCII Art",
    icon: "ğŸ¨",
    path: "/ascii-art",
    desc: "Turn text into beautiful ASCII masterpieces.",
    category: "Creative",
  },
  {
    name: "Meme Generator",
    icon: "ğŸ¸",
    path: "/meme-generator",
    desc: "Create viral memes in seconds.",
    category: "Creative",
  },
  {
    name: "Hangman",
    icon: "ğŸ˜µ",
    path: "/hangman",
    desc: "Classic word guessing game.",
    category: "Game",
  },
  {
    name: "Hash Generator",
    icon: "##",
    path: "/hash-generator",
    desc: "Create cryptographic hashes (MD5, SHA).",
    category: "Security",
  },
  {
    name: "Base64 Tool",
    icon: "64",
    path: "/base64-tool",
    desc: "Encode and decode Base64 strings.",
    category: "Dev",
  },
];
---

<Layout title="Discovery Hub">
  <div class="relative min-h-screen pb-12">
    <!-- Background Decor -->
    <div
      class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none"
    >
      <div
        class="absolute top-[-10%] left-[-10%] w-[50%] h-[50%] bg-blue-600/10 rounded-full blur-[120px] animate-pulse"
      >
      </div>
      <div
        class="absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] bg-violet-600/10 rounded-full blur-[120px] animate-pulse"
        style="animation-delay: 2s;"
      >
      </div>
    </div>

    <div
      class="container mx-auto px-4 h-full flex flex-col items-center justify-center relative overflow-hidden"
      id="game-area"
    >
      <!-- Big Scoreboard -->
      <div
        id="scoreboard"
        class="absolute top-10 left-1/2 -translate-x-1/2 text-center opacity-0 transition-opacity duration-500 pointer-events-none z-10"
      >
        <div
          class="text-8xl font-black text-transparent bg-clip-text bg-gradient-to-b from-blue-400 to-violet-600 drop-shadow-2xl"
          id="score-val"
        >
          0
        </div>
        <div
          class="text-xl text-slate-400 font-bold tracking-[0.5em] uppercase"
        >
          Bugs Smashed
        </div>
      </div>

      <!-- Start Screen -->
      <div id="start-screen" class="text-center relative z-20">
        <div class="mb-12 relative animate-float">
          <div
            class="absolute -left-24 top-1/2 -translate-y-1/2 text-6xl animate-pulse"
          >
            ğŸ‘‰
          </div>

          <button
            id="start-debug"
            class="group relative bg-gradient-to-br from-red-500 to-orange-600 text-white w-64 h-64 rounded-full text-3xl font-black border-8 border-white/10 shadow-[0_0_100px_rgba(239,68,68,0.4)] hover:shadow-[0_0_150px_rgba(239,68,68,0.6)] hover:scale-110 active:scale-95 transition-all duration-300 flex flex-col items-center justify-center overflow-hidden"
          >
            <div
              class="absolute inset-0 bg-[url('/noise.png')] opacity-10 mix-blend-overlay"
            >
            </div>
            <span
              class="text-6xl mb-2 group-hover:rotate-12 transition-transform"
              >ğŸª²</span
            >
            <span class="relative z-10">DEBUG<br />NOW</span>
          </button>

          <div
            class="absolute -right-24 top-1/2 -translate-y-1/2 text-6xl animate-pulse delay-75"
          >
            ğŸ‘ˆ
          </div>
        </div>

        <p class="text-slate-500 text-lg font-mono">
          The system is crawling with bugs.<br />Only YOU can fix it.
        </p>
      </div>

      <!-- Bug Container -->
      <div id="bug-container" class="fixed inset-0 pointer-events-none z-50">
      </div>
    </div>
  </div>
</Layout>

<style>
  .custom-cursor {
    cursor:
      url("/cursor-swatter.png") 16 128,
      auto;
  }
  .custom-cursor:active {
    cursor:
      url("/cursor-swatter.png") 16 128,
      auto;
    animation: swat 0.1s;
  }
  @keyframes swat {
    0% {
      transform: rotate(0deg);
    }
    50% {
      transform: rotate(-45deg);
    }
    100% {
      transform: rotate(0deg);
    }
  }
</style>

<script>
  // Bug Smasher V2
  const startBtn = document.getElementById("start-debug");
  const startScreen = document.getElementById("start-screen");
  const scoreboard = document.getElementById("scoreboard");
  const scoreVal = document.getElementById("score-val");
  const bugContainer = document.getElementById("bug-container");
  const gameArea = document.getElementById("game-area");

  let score = 0;
  let gameActive = false;

  if (startBtn && bugContainer) {
    startBtn.addEventListener("click", () => {
      startGame();
    });

    function startGame() {
      if (gameActive) return;
      gameActive = true;
      score = 0;
      updateScore(0);

      // UI Transitions
      startScreen?.classList.add("scale-y-0", "opacity-0");
      setTimeout(() => startScreen?.classList.add("hidden"), 300);

      scoreboard?.classList.remove("opacity-0");
      document.body.classList.add("custom-cursor");

      // Spawn Loop
      const spawnInterval = setInterval(spawnBug, 600);

      // Game Over after 60s (or simplify to endless for now)
      // For now, endless fun
    }

    function updateScore(newScore: number) {
      if (scoreVal) scoreVal.textContent = newScore.toString();
    }

    function spawnBug() {
      if (!gameActive) return;

      const bug = document.createElement("div");
      bug.textContent = "ğŸª²";
      bug.style.position = "absolute";
      bug.style.fontSize = "40px"; // Bigger bugs
      bug.style.width = "80px"; // Bigger hitbox
      bug.style.height = "80px";
      bug.style.display = "flex";
      bug.style.alignItems = "center";
      bug.style.justifyContent = "center";
      bug.style.cursor = "url('/cursor-swatter.png') 16 128, auto"; // Maintain cursor on hover
      bug.style.pointerEvents = "auto";
      bug.style.userSelect = "none";
      bug.style.transition = "transform 0.1s linear";
      bug.style.zIndex = "100";

      // Random start
      const startSide = Math.random() > 0.5 ? "left" : "right";
      const startY = Math.random() * (window.innerHeight - 100) + 50;

      bug.style.top = `${startY}px`;
      bug.style[startSide] = "-100px";

      bugContainer?.appendChild(bug);

      // Movement Logic
      let pos = -100;
      const speed = Math.random() * 4 + 3; // Faster
      const wobbleSpeed = Math.random() * 0.1 + 0.05;
      const wobbleAmp = Math.random() * 60 + 20;

      const moveInterval = setInterval(() => {
        if (!gameActive) {
          clearInterval(moveInterval);
          bug.remove();
          return;
        }

        pos += speed;
        bug.style[startSide] = `${pos}px`;
        bug.style.transform = `translateY(${Math.sin(pos * wobbleSpeed) * wobbleAmp}px) rotate(${startSide === "left" ? 90 : -90}deg)`;

        if (pos > window.innerWidth) {
          clearInterval(moveInterval);
          bug.remove();
        }
      }, 16);

      // Smash Logic
      bug.addEventListener("click", (e) => {
        e.stopPropagation(); // Prevent clicks falling through
        score++;
        updateScore(score);

        // Splat Visuals
        clearInterval(moveInterval);
        bug.textContent = "ğŸ’¥";
        bug.style.transform = "scale(2) rotate(Math.random() * 360deg)";
        bug.style.pointerEvents = "none"; // Cant click again

        // Sound effect (optional, maybe later)

        setTimeout(() => {
          bug.style.opacity = "0";
          bug.style.transition = "opacity 0.5s";
          setTimeout(() => bug.remove(), 500);
        }, 500);
      });
    }
  }
</script>
