---
import Button from "@/components/ui/Button.astro";
import ToolCard from "@/components/ui/ToolCard.astro";
import ToolPage from "@/components/ui/ToolPage.astro";
import Layout from "../layouts/Layout.astro";
---

<Layout title="Food Picker">
  <ToolPage description="Can't decide? Let the algorithm choose your next meal.">
    <div class="mx-auto flex w-full min-h-0 flex-1 flex-col max-w-2xl gap-3">
      <ToolCard title="Decision Machine" step="01.">
        <!-- Result Display -->
        <div
          id="result-container"
          class="mb-3 flex min-h-0 flex-col items-center justify-center rounded-2xl border border-white/5 bg-black/20 p-3 shadow-inner"
        >
          <div id="initial-state" class="group text-center">
            <div
              class="mb-2 animate-bounce text-4xl drop-shadow-xl filter transition-transform group-hover:scale-110"
            >
              ðŸ¤”
            </div>
            <p class="text-xs font-bold tracking-widest text-slate-500 uppercase">
              Awaiting input...
            </p>
          </div>

          <div
            id="result-content"
            class="animate-in fade-in zoom-in hidden text-center duration-500"
          >
            <div id="result-emoji" class="mb-2 text-5xl drop-shadow-2xl filter"></div>
            <h2 id="result-name" class="mb-2 text-4xl font-extrabold text-white"></h2>
            <div
              id="result-category"
              class="inline-block rounded-full border border-indigo-500/20 bg-indigo-500/10 px-4 py-1 text-[10px] font-bold tracking-widest text-indigo-400 uppercase"
            >
            </div>
          </div>
        </div>

        <div class="space-y-3">
          <!-- Categories -->
          <div class="space-y-2">
            <p class="text-center text-[10px] font-bold tracking-widest text-slate-500 uppercase">
              Select Filter
            </p>
            <div class="flex flex-wrap justify-center gap-2" id="category-filters">
              <Button variant="primary" size="sm" class="category-btn" data-category="All">
                All
              </Button>
              <Button variant="secondary" size="sm" class="category-btn" data-category="Fast Food">
                Fast Food
              </Button>
              <Button variant="secondary" size="sm" class="category-btn" data-category="Healthy">
                Healthy
              </Button>
              <Button variant="secondary" size="sm" class="category-btn" data-category="Asian">
                Asian
              </Button>
              <Button variant="secondary" size="sm" class="category-btn" data-category="Italian">
                Italian
              </Button>
              <Button variant="secondary" size="sm" class="category-btn" data-category="Sweet">
                Sweet
              </Button>
            </div>
          </div>

          <div class="flex justify-center pt-2">
            <Button id="spin-btn" variant="primary" class="h-14 w-full px-6 text-lg sm:w-auto">
              Pick Food ðŸŽ²
            </Button>
          </div>
        </div>
      </ToolCard>
    </div>
  </ToolPage>
</Layout>

<script>
  // Food Data
  const foods = [
    { name: "Pizza", emoji: "ðŸ•", category: "Italian" },
    { name: "Burger", emoji: "ðŸ”", category: "Fast Food" },
    { name: "Sushi", emoji: "ðŸ£", category: "Asian" },
    { name: "Salad", emoji: "ðŸ¥—", category: "Healthy" },
    { name: "Tacos", emoji: "ðŸŒ®", category: "Mexican" },
    { name: "Pasta", emoji: "ðŸ", category: "Italian" },
    { name: "Ramen", emoji: "ðŸœ", category: "Asian" },
    { name: "Steak", emoji: "ðŸ¥©", category: "Fancy" },
    { name: "Sandwich", emoji: "ðŸ¥ª", category: "Lunch" },
    { name: "Dim Sum", emoji: "ðŸ¥Ÿ", category: "Asian" },
    { name: "Fried Chicken", emoji: "ðŸ—", category: "Fast Food" },
    { name: "Donut", emoji: "ðŸ©", category: "Sweet" },
    { name: "Poke Bowl", emoji: "ðŸ¥£", category: "Healthy" },
    { name: "Burrito", emoji: "ðŸŒ¯", category: "Mexican" },
    { name: "Ice Cream", emoji: "ðŸ¦", category: "Sweet" },
    { name: "Curry", emoji: "ðŸ›", category: "Asian" },
  ];

  // State
  let activeCategory = "All";
  let isSpinning = false;

  // Elements
  const resultContainer = document.getElementById("result-content");
  const initialState = document.getElementById("initial-state");
  const resultName = document.getElementById("result-name");
  const resultEmoji = document.getElementById("result-emoji");
  const resultCategory = document.getElementById("result-category");
  const spinBtn = document.getElementById("spin-btn");
  const categoryBtns = document.querySelectorAll(".category-btn");

  // Filter Logic
  categoryBtns.forEach((btn) => {
    btn.addEventListener("click", () => {
      if (isSpinning) return;

      // Reset all buttons to secondary variants
      categoryBtns.forEach((b) => {
        b.classList.remove(
          "bg-indigo-600",
          "text-white",
          "hover:bg-indigo-500",
          "active:bg-indigo-700",
          "shadow-lg",
          "shadow-indigo-500/20"
        );
        b.classList.add(
          "bg-white/5",
          "text-white",
          "border",
          "border-white/10",
          "hover:bg-white/10",
          "active:bg-white/20",
          "backdrop-blur-sm"
        );
      });

      // Update active button to primary variant
      btn.classList.remove(
        "bg-white/5",
        "text-white",
        "border",
        "border-white/10",
        "hover:bg-white/10",
        "active:bg-white/20",
        "backdrop-blur-sm"
      );
      btn.classList.add(
        "bg-indigo-600",
        "text-white",
        "hover:bg-indigo-500",
        "active:bg-indigo-700",
        "shadow-lg",
        "shadow-indigo-500/20"
      );

      activeCategory = btn.getAttribute("data-category") || "All";
    });
  });

  // Spin Logic
  spinBtn?.addEventListener("click", () => {
    if (isSpinning) return;

    isSpinning = true;
    initialState?.classList.add("hidden");
    resultContainer?.classList.remove("hidden");

    // Filter available foods
    const candidates =
      activeCategory === "All" ? foods : foods.filter((f) => f.category === activeCategory);

    if (candidates.length === 0) {
      if (resultName) resultName.textContent = "No foods found!";
      if (resultEmoji) resultEmoji.textContent = "ðŸ˜¢";
      if (resultCategory) resultCategory.textContent = "Try another category";
      isSpinning = false;
      return;
    }

    // Animation Effect
    let iterations = 0;
    const maxIterations = 20;
    const interval = setInterval(() => {
      const randomFood = candidates[Math.floor(Math.random() * candidates.length)];

      if (resultName) resultName.textContent = randomFood.name;
      if (resultEmoji) resultEmoji.textContent = randomFood.emoji;
      if (resultCategory) resultCategory.textContent = randomFood.category;

      iterations++;

      if (iterations >= maxIterations) {
        clearInterval(interval);
        isSpinning = false;
      }
    }, 100);
  });
</script>
