---
import Button from "../components/Button.astro";
import Layout from "../layouts/Layout.astro";
---

<Layout title="UUID Generator">
  <div class="space-y-12">
    <div class="animate-fade-in mb-8 flex justify-center">
      <p
        class="rounded-full border border-white/10 bg-white/5 px-6 py-2 text-sm font-medium text-slate-300 backdrop-blur-md transition-all hover:bg-white/10 hover:text-white"
      >
        Generate RFC 4122 v4 UUIDs instantly.
      </p>
    </div>

    <div class="grid gap-8 lg:grid-cols-3">
      <div class="space-y-6 lg:col-span-1">
        <div class="card-glass">
          <h2 class="mb-4 text-lg font-bold text-white">
            <span class="text-emerald-400">01.</span> Settings
          </h2>

          <div class="space-y-4">
            <div>
              <label for="count-range" class="mb-2 block text-sm font-medium text-slate-400"
                >Count: <span id="count-value" class="text-slate-200">5</span></label
              >
              <input id="count-range" type="range" min="1" max="20" value="5" class="w-full" />
            </div>

            <label
              class="flex cursor-pointer items-center gap-3 rounded-lg border border-white/10 bg-white/5 p-3 text-sm text-slate-300 transition-all hover:bg-white/10"
            >
              <input
                id="uppercase-toggle"
                type="checkbox"
                class="h-4 w-4 rounded border-slate-600 bg-slate-800 text-emerald-500 focus:ring-emerald-500"
              />
              Uppercase
            </label>

            <label
              class="flex cursor-pointer items-center gap-3 rounded-lg border border-white/10 bg-white/5 p-3 text-sm text-slate-300 transition-all hover:bg-white/10"
            >
              <input
                id="compact-toggle"
                type="checkbox"
                class="h-4 w-4 rounded border-slate-600 bg-slate-800 text-emerald-500 focus:ring-emerald-500"
              />
              Remove hyphens
            </label>

            <Button id="generate-btn" class="mt-2 w-full px-10 sm:w-auto" variant="primary">
              <span class="text-base">âš¡</span> Generate
            </Button>
          </div>
        </div>
      </div>

      <div class="lg:col-span-2">
        <div class="card-glass flex min-h-[480px] flex-col">
          <div class="mb-4 flex flex-wrap items-center justify-between gap-4">
            <h2 class="text-lg font-bold text-white">
              <span class="text-cyan-400">02.</span> Output
            </h2>
            <div class="flex flex-wrap gap-2">
              <Button id="copy-btn" variant="secondary" class="px-4 py-2 text-sm">Copy</Button>
              <Button id="clear-btn" variant="ghost" class="px-4 py-2 text-sm">Clear</Button>
            </div>
          </div>

          <div class="flex-1 overflow-auto rounded-xl border border-white/10 bg-black/50 p-4">
            <pre
              id="uuid-output"
              class="min-h-[320px] text-sm whitespace-pre-wrap text-slate-100">Ready to generate UUIDs.</pre>
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>

<script>
  const countRange = document.querySelector("#count-range") as HTMLInputElement;
  const countValue = document.querySelector("#count-value") as HTMLSpanElement;
  const uppercaseToggle = document.querySelector("#uppercase-toggle") as HTMLInputElement;
  const compactToggle = document.querySelector("#compact-toggle") as HTMLInputElement;
  const generateBtn = document.querySelector("#generate-btn") as HTMLButtonElement;
  const copyBtn = document.querySelector("#copy-btn") as HTMLButtonElement;
  const clearBtn = document.querySelector("#clear-btn") as HTMLButtonElement;
  const outputEl = document.querySelector("#uuid-output") as HTMLPreElement;

  const fallbackUuid = () =>
    "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, (char) => {
      const rand = (Math.random() * 16) | 0;
      const value = char === "x" ? rand : (rand & 0x3) | 0x8;
      return value.toString(16);
    });

  const createUuid = () => {
    if (crypto?.randomUUID) return crypto.randomUUID();
    return fallbackUuid();
  };

  const updateCount = () => {
    countValue.textContent = countRange.value;
  };

  const formatUuid = (uuid: string) => {
    let value = uuid;
    if (compactToggle.checked) {
      value = value.replace(/-/g, "");
    }
    if (uppercaseToggle.checked) {
      value = value.toUpperCase();
    }
    return value;
  };

  const generateUuids = () => {
    const total = Number.parseInt(countRange.value, 10);
    const list = Array.from({ length: total }, () => formatUuid(createUuid()));
    outputEl.textContent = list.join("\n");
  };

  generateBtn.addEventListener("click", generateUuids);
  countRange.addEventListener("input", updateCount);

  copyBtn.addEventListener("click", async () => {
    try {
      await navigator.clipboard.writeText(outputEl.textContent);
      copyBtn.textContent = "Copied!";
      setTimeout(() => {
        copyBtn.textContent = "Copy";
      }, 1200);
    } catch {
      copyBtn.textContent = "Copy failed";
      setTimeout(() => {
        copyBtn.textContent = "Copy";
      }, 1200);
    }
  });

  clearBtn.addEventListener("click", () => {
    outputEl.textContent = "Ready to generate UUIDs.";
  });

  updateCount();
  generateUuids();
</script>
