---
const themes = [
  { id: "neon", name: "Neon Cyber", color: "#00FFA3" },
  { id: "sunset", name: "Sunset Lux", color: "#FF9A8B" },
  { id: "oceanic", name: "Oceanic", color: "#2193B0" },
  { id: "purple", name: "Royale", color: "#8E2DE2" },
  { id: "forest", name: "Forest", color: "#22c55e" },
  { id: "berry", name: "Berry", color: "#db2777" },
  { id: "midnight", name: "Midnight", color: "#6366f1" },
  { id: "solar", name: "Solar", color: "#f59e0b" },
  { id: "arctic", name: "Arctic", color: "#0ea5e9" },
  { id: "minimal", name: "Frosted", color: "#FFFFFF" },
];
---

<div class="relative z-50">
  <button
    id="theme-btn"
    class="flex items-center gap-2 px-3 py-2 rounded-xl glass hover:glass-hover transition-all justify-center min-w-[40px]"
    aria-label="Change theme"
  >
    <span class="text-xl">ðŸŽ¨</span>
  </button>

  <!-- Dropdown -->
  <div
    id="theme-dropdown"
    class="absolute top-full right-0 mt-2 w-48 p-2 rounded-xl bg-slate-950 border border-white/10 shadow-2xl opacity-0 invisible transition-all duration-300 transform origin-top-right z-50 scale-95"
  >
    <div class="space-y-1">
      {
        themes.map((theme) => (
          <button
            class="theme-option w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-white/10 transition-colors text-sm font-medium text-left"
            data-theme={theme.id}
          >
            <span
              class="w-4 h-4 rounded-full shadow-sm border border-white/20"
              style={`background: ${theme.color}`}
            />
            <span class="text-slate-200">{theme.name}</span>
          </button>
        ))
      }
    </div>
  </div>
</div>

<script>
  const themeBtn = document.getElementById("theme-btn");
  const themeDropdown = document.getElementById("theme-dropdown");

  // Toggle Dropdown
  themeBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    const isOpen = !themeDropdown?.classList.contains("invisible");

    if (isOpen) {
      closeDropdown();
    } else {
      openDropdown();
    }
  });

  function openDropdown() {
    themeDropdown?.classList.remove("opacity-0", "invisible", "scale-95");
    themeDropdown?.classList.add("opacity-100", "visible", "scale-100");
  }

  function closeDropdown() {
    themeDropdown?.classList.add("opacity-0", "invisible", "scale-95");
    themeDropdown?.classList.remove("opacity-100", "visible", "scale-100");
  }

  // Close on click outside
  document.addEventListener("click", (e) => {
    if (
      themeDropdown &&
      !themeDropdown.contains(e.target as Node) &&
      !themeBtn?.contains(e.target as Node)
    ) {
      closeDropdown();
    }
  });

  // Theme Logic
  const initTheme = () => {
    const savedTheme = localStorage.getItem("theme") || "neon";
    document.documentElement.setAttribute("data-theme", savedTheme);
  };

  const setTheme = (themeId: string) => {
    document.documentElement.setAttribute("data-theme", themeId);
    localStorage.setItem("theme", themeId);
    closeDropdown();
  };

  // Event Listeners
  document.querySelectorAll(".theme-option").forEach((btn) => {
    btn.addEventListener("click", (e) => {
      e.stopPropagation();
      const theme = (e.currentTarget as HTMLElement).dataset.theme;
      if (theme) setTheme(theme);
    });
  });

  // Run on load
  initTheme();
  document.addEventListener("astro:after-swap", initTheme); // For Astro ViewTransitions if enabled
</script>
